<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" >
    <title>点评头条</title>
    <link rel="stylesheet" href="static/css/headline.css">
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
</head>
<body>
    
</body>
<script>
    $(function () {
        //$.ajax("http://10.76.177.224:4080/invoke.json?url=http://service.dianping.com/search/queryAnnotationService&method=getAnnotationInfo&parameterTypes=com.dp.search.kqu.model.QueryRequestInfo&parameters={%22cityID%22:1,%22needRewrite%22:true,%22keyword%22:%22%E6%92%A9%E6%B1%A4%22,%22needQCA%22:%22true%22}", {
        $.get("json.html?" + getKeyword(),{}, 
            function (data) {
                var jsonData = eval("(" + data + ")");
                jsonData.article.forEach(function(paraData) {
                    var p = $("<p></p>");
                    paraData.forEach(function(elementData) {
                        switch (elementData.type) {
                            case "text":
                                p.append(genTextElement(elementData));
                                break;
                            case "image":
                                p.append(genImageElement(elementData));
                                break;
                        }
                    });
                    $("body").append(p);
                });
            }
        );
    });

    function genTextElement(elementData) {
        return $("<span>" + elementData.text + "</span>");
    }

    function genImageElement(elementData) {
        var img = $("<img src=" + elementData.url + ">");
        if (elementData.width == 0 && elementData.height == 0) {
            img.addClass("pic-fullwidth");
        } else {
            img.attr("width", elementData.width);
            img.attr("height", elementData.height);
        }
        return img;
    }

    function getKeyword() {
        return window.location.search.substr(1).split("=")[1];
    }
</script>
</html>
